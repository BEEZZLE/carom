using System;
using System.Collections.Generic;
using System.Linq;

// 아이템 클래스
class Item
{
    public string Name;
    public string Description;
    public int Price;
    public int Attack;
    public int Defense;
    public bool IsEquipped;
    public bool IsPurchased;

    public Item(string name, string description, int price, int attack, int defense)
    {
        Name = name;
        Description = description;
        Price = price;
        Attack = attack;
        Defense = defense;
        IsEquipped = false;
        IsPurchased = false;
    }
}

// 플레이어 클래스
class Player
{
    public string Name;
    public int Level = 1;
    public string Job = "전사";
    public int BaseAttack = 10;
    public int BaseDefense = 5;
    public int MaxHp = 100;
    public int Hp = 100;
    public int Gold = 1500;
    public List<Item> Inventory = new List<Item>();

    public int TotalAttack => BaseAttack + Inventory.Where(i => i.IsEquipped).Sum(i => i.Attack);
    public int TotalDefense => BaseDefense + Inventory.Where(i => i.IsEquipped).Sum(i => i.Defense);

    public void ShowStatus()
    {
        Console.WriteLine("\n상태 보기");
        Console.WriteLine("캐릭터의 정보가 표시됩니다.\n");

        Console.WriteLine($"Lv. {Level:D2}");
        Console.WriteLine($"{Name} ( {Job} )");
        Console.WriteLine($"공격력 : {TotalAttack}");
        Console.WriteLine($"방어력 : {TotalDefense}");
        Console.WriteLine($"체 력 : {Hp}");
        Console.WriteLine($"Gold : {Gold} G");
    }
}

class Program
{
    static Player player = new Player();
    static List<Item> shopItems = new List<Item>();

    static void Main()
    {
        Console.WriteLine("스파르타 마을에 오신 여러분 환영합니다.");
        Console.WriteLine("이곳에서 던전으로 들어가기전 활동을 할 수 있습니다.\n");

        player.Name = "Chad"; // 플레이어 이름 설정

        InitializeShop();
        InitializeInventory();

        // 메인 루프
        while (true)
        {
            ShowMainMenu();
            Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
            string input = Console.ReadLine();

            switch (input)
            {
                case "1":
                    player.ShowStatus();
                    ShowExitOption();
                    break;
                case "2":
                    InventoryMenu();
                    break;
                case "3":
                    ShopMenu();
                    break;
                case "4":
                    EnterDungeon();
                    break;
                case "5":
                    Rest();
                    break;
                default:
                    Console.WriteLine("잘못된 입력입니다.");
                    break;
            }
        }
    }

    static void ShowMainMenu()
    {
        Console.WriteLine("\n1. 상태 보기");
        Console.WriteLine("2. 인벤토리");
        Console.WriteLine("3. 상점");
        Console.WriteLine("4. 던전입장");
        Console.WriteLine("5. 휴식하기");
    }

    static void ShowExitOption()
    {
        Console.WriteLine("\n0. 나가기");
        Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
        string input = Console.ReadLine();
    }

    static void InitializeInventory()
    {
        player.Inventory.Add(new Item("무쇠갑옷", "무쇠로 만들어져 튼튼한 갑옷입니다.", 1000, 0, 5) { IsEquipped = true, IsPurchased = true });
        player.Inventory.Add(new Item("스파르타의 창", "스파르타의 전사들이 사용했다는 전설의 창입니다.", 2000, 7, 0) { IsEquipped = true, IsPurchased = true });
        player.Inventory.Add(new Item("낡은 검", "쉽게 볼 수 있는 낡은 검 입니다.", 600, 2, 0) { IsEquipped = false, IsPurchased = true });
    }

    static void InitializeShop()
    {
        shopItems.Add(new Item("수련자 갑옷", "수련에 도움을 주는 갑옷입니다.", 1000, 0, 5));
        shopItems.Add(new Item("무쇠갑옷", "무쇠로 만들어져 튼튼한 갑옷입니다.", 1500, 0, 9) { IsPurchased = true });
        shopItems.Add(new Item("스파르타의 갑옷", "스파르타의 전사들이 사용했다는 전설의 갑옷입니다.", 3500, 0, 15));
        shopItems.Add(new Item("낡은 검", "쉽게 볼 수 있는 낡은 검 입니다.", 600, 2, 0));
        shopItems.Add(new Item("청동 도끼", "어디선가 사용됐던거 같은 도끼입니다.", 1500, 5, 0));
        shopItems.Add(new Item("스파르타의 창", "스파르타의 전사들이 사용했다는 전설의 창입니다.", 2000, 7, 0) { IsPurchased = true });
    }

    static void InventoryMenu()
    {
        Console.WriteLine("\n인벤토리");
        Console.WriteLine("보유 중인 아이템을 관리할 수 있습니다.\n");

        Console.WriteLine("[아이템 목록]\n");

        int idx = 1;
        foreach (var item in player.Inventory)
        {
            string equipped = item.IsEquipped ? "[E]" : "";
            Console.WriteLine($"- {idx++} {equipped}{item.Name} | {(item.Attack > 0 ? $"공격력 +{item.Attack}" : $"방어력 +{item.Defense}")} | {item.Description}");
        }

        Console.WriteLine("\n1. 장착 관리");
        Console.WriteLine("0. 나가기");

        Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
        string input = Console.ReadLine();

        if (input == "1")
        {
            EquipManagement();
        }
    }

    static void EquipManagement()
    {
        Console.WriteLine("\n인벤토리 - 장착 관리");
        Console.WriteLine("보유 중인 아이템을 관리할 수 있습니다.\n");

        Console.WriteLine("[아이템 목록]\n");

        int idx = 1;
        foreach (var item in player.Inventory)
        {
            string equipped = item.IsEquipped ? "[E]" : "";
            Console.WriteLine($"- {idx++} {equipped}{item.Name} | {(item.Attack > 0 ? $"공격력 +{item.Attack}" : $"방어력 +{item.Defense}")} | {item.Description}");
        }

        Console.WriteLine("\n0. 나가기");
        Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
        string input = Console.ReadLine();

        if (int.TryParse(input, out int num) && num >= 1 && num <= player.Inventory.Count)
        {
            var item = player.Inventory[num - 1];
            item.IsEquipped = !item.IsEquipped;
            Console.WriteLine(item.IsEquipped ? "장착했습니다." : "장착을 해제했습니다.");
        }
    }

    static void ShopMenu()
    {
        Console.WriteLine("\n상점");
        Console.WriteLine("필요한 아이템을 얻을 수 있는 상점입니다.\n");

        Console.WriteLine($"[보유 골드]\n{player.Gold} G\n");

        Console.WriteLine("[아이템 목록]");
        int idx = 1;
        foreach (var item in shopItems)
        {
            string priceOrStatus = item.IsPurchased ? "구매완료" : $"{item.Price} G";
            Console.WriteLine($"- {item.Name} | {(item.Attack > 0 ? $"공격력 +{item.Attack}" : $"방어력 +{item.Defense}")} | {item.Description} | {priceOrStatus}");
            idx++;
        }

        Console.WriteLine("\n1. 아이템 구매");
        Console.WriteLine("0. 나가기");

        Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
        string input = Console.ReadLine();

        if (input == "1")
        {
            ShopBuyMenu();
        }
    }

    static void ShopBuyMenu()
    {
        Console.WriteLine("\n상점 - 아이템 구매");
        Console.WriteLine("필요한 아이템을 얻을 수 있는 상점입니다.\n");

        Console.WriteLine($"[보유 골드]\n{player.Gold} G\n");

        Console.WriteLine("[아이템 목록]");
        int idx = 1;
        foreach (var item in shopItems)
        {
            string priceOrStatus = item.IsPurchased ? "구매완료" : $"{item.Price} G";
            Console.WriteLine($"- {idx++} {item.Name} | {(item.Attack > 0 ? $"공격력 +{item.Attack}" : $"방어력 +{item.Defense}")} | {item.Description} | {priceOrStatus}");
        }

        Console.WriteLine("\n0. 나가기");
        Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
        string input = Console.ReadLine();

        if (int.TryParse(input, out int num) && num >= 1 && num <= shopItems.Count)
        {
            var selected = shopItems[num - 1];
            if (selected.IsPurchased)
            {
                Console.WriteLine("이미 구매한 아이템입니다.");
            }
            else if (player.Gold >= selected.Price)
            {
                player.Gold -= selected.Price;
                player.Inventory.Add(new Item(selected.Name, selected.Description, selected.Price, selected.Attack, selected.Defense) { IsPurchased = true });
                selected.IsPurchased = true;
                Console.WriteLine("구매를 완료했습니다.");
            }
            else
            {
                Console.WriteLine("Gold가 부족합니다.");
            }
        }
        else
        {
            Console.WriteLine("잘못된 입력입니다.");
        }
    }

    static void Rest()
    {
        Console.WriteLine("\n휴식하기");
        Console.WriteLine($"500 G 를 내면 체력을 회복할 수 있습니다. (보유 골드 : {player.Gold} G)\n");

        Console.WriteLine("1. 휴식하기");
        Console.WriteLine("0. 나가기");

        Console.Write("\n원하시는 행동을 입력해주세요.\n>> ");
        string input = Console.ReadLine();

        if (input == "1")
        {
            if (player.Gold >= 500)
            {
                player.Gold -= 500;
                player.Hp = player.MaxHp;
                Console.WriteLine("휴식을 완료했습니다. 체력이 모두 회복되었습니다.");
            }
            else
            {
                Console.WriteLine("Gold가 부족합니다.");
            }
        }
    }

    static void EnterDungeon()
    {
        Console.WriteLine("\n(던전 입장은 아직 구현 준비 중입니다.)");
    }
}
